<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="build-version" content="20260301-143430">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadcetera â€” Band HQ</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS / Safari PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Deadcetera">
    <link rel="apple-touch-icon" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">

    <!-- Android / Chrome -->
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="shortcut icon" href="favicon.ico">

    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="app-shell.css">
</head>
<body>
    <!-- TOP BAR -->
    <div class="topbar">
        <div class="topbar-left">
            <button class="hamburger" onclick="toggleMenu()" aria-label="Menu">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="topbar-brand" onclick="showPage('songs')" style="cursor:pointer">Deadcetera</span>
        </div>
        <div class="topbar-right">
            <button id="googleDriveAuthBtn" class="topbar-btn" onclick="handleGoogleDriveAuth()">ğŸ”— Connect</button>
            <button class="topbar-btn" onclick="showPage('admin')" title="Settings &amp; Admin" style="padding:6px 8px">âš™ï¸</button>
        </div>
    </div>

    <!-- SLIDE-OUT MENU -->
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
    <nav class="slide-menu" id="slideMenu">
        <div class="menu-brand">ğŸ¸ Deadcetera</div>
        <div class="menu-section">
            <div class="menu-section-title">Music</div>
            <button class="menu-item active" data-page="songs" onclick="showPage('songs')"><span class="menu-icon">ğŸµ</span> Song Library</button>
            <button class="menu-item" data-page="setlists" onclick="showPage('setlists')"><span class="menu-icon">ğŸ“‹</span> Setlists</button>
            <button class="menu-item" data-page="playlists" onclick="showPage('playlists')"><span class="menu-icon">ğŸ§</span> Playlists</button>
            <button class="menu-item" data-page="practice" onclick="showPage('practice')"><span class="menu-icon">ğŸ“…</span> Practice Plan</button>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-section">
            <div class="menu-section-title">Band</div>
            <button class="menu-item" data-page="calendar" onclick="showPage('calendar')"><span class="menu-icon">ğŸ“†</span> Calendar</button>
            <button class="menu-item" data-page="gigs" onclick="showPage('gigs')"><span class="menu-icon">ğŸ¤</span> Gigs</button>
            <button class="menu-item" data-page="venues" onclick="showPage('venues')"><span class="menu-icon">ğŸ›ï¸</span> Venues & Contacts</button>
            <button class="menu-item" data-page="social" onclick="showPage('social')"><span class="menu-icon">ğŸ“£</span> Social Media</button>
            <button class="menu-item" data-page="finances" onclick="showPage('finances')"><span class="menu-icon">ğŸ’°</span> Finances</button>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-section">
            <div class="menu-section-title">Tools</div>
            <button class="menu-item" data-page="tuner" onclick="showPage('tuner')"><span class="menu-icon">ğŸ¸</span> Guitar Tuner</button>
            <button class="menu-item" data-page="metronome" onclick="showPage('metronome')"><span class="menu-icon">ğŸ¥</span> Metronome</button>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-section">
            <button class="menu-item" data-page="equipment" onclick="showPage('equipment')"><span class="menu-icon">ğŸ›ï¸</span> Equipment</button>
            <button class="menu-item" data-page="contacts" onclick="showPage('contacts')"><span class="menu-icon">ğŸ‘¥</span> Contacts</button>
            <button class="menu-item" data-page="notifications" onclick="showPage('notifications')"><span class="menu-icon">ğŸ””</span> Notifications</button>
            <button class="menu-item" data-page="admin" onclick="showPage('admin')"><span class="menu-icon">âš™ï¸</span> Settings & Admin</button>
            <div class="menu-divider"></div>
            <button class="menu-item" data-page="help" onclick="showPage('help')"><span class="menu-icon">â“</span> Help & Guide</button>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <div class="main-content" id="mainContent">
        <!-- PAGE: Songs (existing app content) -->
        <div id="page-songs" class="app-page">
    <div class="container">
        <header>
            <!-- Logo placeholder - replace logo.png with your actual logo -->
            <img src="logo.png" alt="Deadcetera" class="logo" onerror="this.style.display='none'">
            <h1>ğŸ¸ Deadcetera</h1>
            <p class="subtitle">One app to jam, plan, and manage â€” so you can focus on the music.</p>
            
            <!-- Sign In -->
            <div id="signInPrompt" style="text-align:center;margin-top:12px;">
                <div style="position:relative;display:inline-block;">
                    <button id="googleDriveAuthBtn2" onclick="handleGoogleDriveAuth()" 
                        style="background:var(--accent);color:white;border:none;padding:10px 20px;border-radius:8px;font-size:0.95em;cursor:pointer;font-weight:600;">
                        ğŸ‘¤ Sign In
                    </button>
                    <button onclick="const t=document.getElementById('signInTooltip');t.style.display=t.style.display==='block'?'none':'block';event.stopPropagation();"
                        style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:var(--text-muted);padding:8px 10px;border-radius:8px;font-size:0.82em;cursor:pointer;margin-left:6px;"
                        title="Why sign in?">â“</button>
                    <div id="signInTooltip" style="display:none;position:absolute;bottom:120%;right:0;margin-bottom:8px;background:var(--bg-card,#1e293b);border:1px solid rgba(255,255,255,0.15);border-radius:10px;padding:14px;width:280px;max-width:80vw;z-index:100;text-align:left;font-size:0.82em;line-height:1.5;color:var(--text-muted,#94a3b8);box-shadow:0 8px 30px rgba(0,0,0,0.4);">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
                            <span style="font-weight:700;color:white">Why sign in?</span>
                            <button onclick="document.getElementById('signInTooltip').style.display='none';event.stopPropagation();" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:1.1em;padding:0 0 0 8px">âœ•</button>
                        </div>
                        <div style="color:var(--green,#10b981);margin-bottom:4px;">âœ… <b>Signed in:</b></div>
                        <div style="margin-left:18px;margin-bottom:8px;">Your name appears on recordings, uploads & votes Â· Band data syncs across all members Â· Access shared setlists, finances & calendar</div>
                        <div style="color:var(--yellow,#f59e0b);margin-bottom:4px;">âš ï¸ <b>Not signed in:</b></div>
                        <div style="margin-left:18px;">You can browse songs & use tools Â· Uploads won't have your name Â· No access to shared band data</div>
                    </div>
                </div>
                <p style="font-size:0.82em;color:var(--text-dim,#64748b);margin-top:6px;">Sign in to sync with your bandmates</p>
            </div>
        </header>

        <!-- Step 1: Song Selection -->
        <div class="step-card" id="step1">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
                <div class="step-number" style="flex-shrink:0">1</div>
                <h2 style="margin:0;line-height:1.2">Song Library</h2>
                <span style="color:var(--text-dim,#64748b);font-size:0.8em;margin-left:auto" id="songCount"></span>
                <button onclick="showCustomSongsList()" class="btn btn-ghost btn-sm" title="Add a custom song not in the library" style="margin-left:6px;font-size:0.75em;padding:4px 8px" id="customSongBtn">
                    â• <span id="customSongCount" style="background:var(--accent);color:white;border-radius:10px;padding:1px 5px;font-size:0.85em;display:none"></span>
                </button>
            </div>
            <div class="search-box">
                <input 
                    type="text" 
                    id="songSearch" 
                    placeholder="Search for a song..." 
                    class="search-input"
                >
            </div>
            <!-- COMPACT FILTERS ROW -->
            <div class="filter-row" style="display:flex;gap:8px;margin:12px 0;flex-wrap:wrap;align-items:center">
                <select id="bandFilter" class="app-select" onchange="filterByBand(this.value)" style="width:auto;min-width:140px;padding:7px 10px;font-size:0.85em;font-weight:600">
                    <option value="all">ğŸ¸ All Bands</option>
                    <option value="GD">Grateful Dead</option>
                    <option value="JGB">Jerry Garcia Band</option>
                    <option value="WSP">Widespread Panic</option>
                    <option value="Phish">Phish</option>
                    <option value="ABB">Allman Brothers</option>
                    <option value="Goose">Goose</option>
                    <option value="DMB">Dave Matthews Band</option>
                    <option value="Other">ğŸµ Other</option>
                </select>
                <select id="statusFilter" class="app-select" onchange="filterByStatus(this.value)" style="width:auto;min-width:140px;padding:7px 10px;font-size:0.85em;font-weight:600">
                    <option value="all">ğŸ“Š All Statuses</option>
                    <option value="prospect">ğŸ‘€ Prospect</option>
                    <option value="wip">ğŸ”§ Work in Progress</option>
                    <option value="gig_ready">âœ… Gig Ready</option>
                </select>
                <span title="ğŸ¯ This Week = songs you're actively rehearsing this week&#10;âœ… Gig Ready = polished and ready to play live&#10;âš ï¸ Needs Polish = know it but needs work&#10;ğŸ“š On Deck = learning, not yet rehearsed" style="cursor:help;color:var(--text-dim,#64748b);font-size:0.9em;margin-left:-4px">â“˜</span>
                <label style="display:flex;align-items:center;gap:5px;cursor:pointer;font-size:0.85em;font-weight:600;color:var(--text-muted,#94a3b8);padding:7px 10px;border:1px solid var(--border,rgba(255,255,255,0.08));border-radius:8px;background:rgba(255,255,255,0.04);min-width:140px" title="Show only songs that have documented vocal harmony parts for the band to practice together">
                    <input type="checkbox" id="harmoniesOnlyFilter" onchange="filterSongsSync(this.checked?'harmonies':'all')" style="accent-color:var(--accent,#667eea);width:14px;height:14px">
                    ğŸ¤ Harmonies
                </label>
                <span title="Filter to show only songs with documented multi-part vocal harmonies" style="cursor:help;color:var(--text-dim,#64748b);font-size:0.9em;margin-left:-4px">â“˜</span>
                <label style="display:flex;align-items:center;gap:5px;cursor:pointer;font-size:0.85em;font-weight:600;color:var(--text-muted,#94a3b8);padding:7px 10px;border:1px solid var(--border,rgba(255,255,255,0.08));border-radius:8px;background:rgba(255,255,255,0.04);min-width:140px" title="Show only songs with a North Star reference version voted on by the band">
                    <input type="checkbox" id="northStarFilter" onchange="toggleNorthStarFilter(this.checked)" style="accent-color:#f59e0b;width:14px;height:14px">
                    â­ North Star
                </label>
                <span title="Show only songs that have a North Star reference version chosen by the band" style="cursor:help;color:var(--text-dim,#64748b);font-size:0.9em;margin-left:-4px">â“˜</span>
            </div>
            
            <div class="song-dropdown" id="songDropdown">
                <!-- Songs populated here -->
            </div>
        </div>

<!-- Step 2: Song Blueprint -->
<div class="step-card hidden" id="step2">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
        <div class="step-number" style="flex-shrink:0">2</div>
        <h2 style="margin:0" id="step2Title">Song DNA</h2>
    </div>
    <p class="subtitle" id="bandResourcesSubtitle">Everything your band needs at a glance</p>
    
    <!-- SONG METADATA -->
    <div class="song-metadata" style="background:rgba(255,255,255,0.04);padding:15px;border-radius:8px;margin-bottom:20px;border:1px solid var(--border,rgba(255,255,255,0.08))">
        <div class="meta-row" style="display:flex;gap:14px;flex-wrap:wrap;align-items:center">
            <div class="meta-item">
                <span style="font-weight:600;color:var(--text-muted,#94a3b8);margin-right:6px">ğŸ¤ Lead:</span>
                <select id="leadSingerSelect" onchange="updateLeadSinger(this.value)" class="app-select" style="width:auto;min-width:100px;padding:5px 8px;font-size:0.85em">
                    <option value="">Select...</option>
                    <option value="drew">Drew</option>
                    <option value="chris">Chris</option>
                    <option value="brian">Brian</option>
                    <option value="pierce">Pierce</option>
                    <option value="drew,chris">Drew & Chris</option>
                </select>
            </div>
            <div class="meta-item">
                <span style="font-weight:600;color:var(--text-muted,#94a3b8);margin-right:6px">ğŸ¯ Status:</span>
                <select id="songStatusSelect" onchange="updateSongStatus(this.value)" class="app-select" style="width:auto;min-width:120px;padding:5px 8px;font-size:0.85em;font-weight:600">
                    <option value="">â€” Not on Radar â€”</option>
                    <option value="prospect">ğŸ‘€ Prospect</option>
                    <option value="wip">ğŸ”§ Work in Progress</option>
                    <option value="gig_ready">âœ… Gig Ready</option>
                </select>
            </div>
            <div class="meta-item">
                <span style="font-weight:600;color:var(--text-muted,#94a3b8);margin-right:6px">ğŸ”‘ Key:</span>
                <select id="songKeySelect" onchange="updateSongKey(this.value)" class="app-select" style="width:auto;min-width:70px;padding:5px 8px;font-size:0.85em">
                    <option value="">â€”</option>
                    <option>A</option><option>Am</option><option>Bb</option><option>Bbm</option>
                    <option>B</option><option>Bm</option><option>C</option><option>Cm</option>
                    <option>C#</option><option>C#m</option><option>D</option><option>Dm</option>
                    <option>Eb</option><option>Ebm</option><option>E</option><option>Em</option>
                    <option>F</option><option>Fm</option><option>F#</option><option>F#m</option>
                    <option>G</option><option>Gm</option><option>Ab</option><option>Abm</option>
                </select>
            </div>
            <div class="meta-item">
                <span style="font-weight:600;color:var(--text-muted,#94a3b8);margin-right:6px">ğŸ¥ BPM:</span>
                <input type="number" id="songBpmInput" min="40" max="240" step="1" placeholder="120" onchange="updateSongBpm(this.value)"
                    class="app-input" style="width:65px;padding:5px 8px;font-size:0.85em">
            </div>
            <div class="meta-item" title="Who starts, who cues the ending, transitions & arrangement">
                <span style="font-weight:600;color:var(--text-muted,#94a3b8);margin-right:6px;cursor:help">ğŸ—ï¸ Structure:</span>
                <span id="songStructureSummary" style="font-size:0.85em;color:var(--text,#f1f5f9)">â€”</span>
                <button class="btn btn-sm btn-ghost" onclick="showSongStructureForm()" style="margin-left:4px;padding:2px 6px;font-size:0.75em" title="Edit song structure">âœï¸</button>
            </div>
        </div>
        <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;margin-top:10px">
            <div class="meta-item">
                <label style="display:flex;align-items:center;gap:6px;cursor:pointer">
                    <input type="checkbox" id="hasHarmoniesCheckbox" onchange="updateHasHarmonies(this.checked)" style="width:16px;height:16px;cursor:pointer;accent-color:var(--accent)">
                    <span style="font-weight:600;color:var(--text-muted,#94a3b8)">ğŸ¶ Harmonies</span>
                </label>
            </div>
            <div class="meta-item" id="harmonyMembersRow" style="display:none;flex-wrap:wrap;gap:6px;align-items:center;width:100%;flex:1 1 100%">
                <span style="font-weight:600;color:var(--text-muted,#94a3b8);font-size:0.85em;flex-shrink:0">Singers:</span>
                <div style="position:relative;flex:1;min-width:140px">
                    <button id="singersDropdownBtn" onclick="toggleSingersDropdown()" 
                        style="width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:6px;padding:5px 10px;color:var(--text,#f1f5f9);font-size:0.85em;cursor:pointer;text-align:left;display:flex;justify-content:space-between;align-items:center">
                        <span id="singersLabel">Select singers...</span>
                        <span>â–¾</span>
                    </button>
                    <div id="singersDropdown" style="display:none;position:absolute;top:100%;left:0;right:0;background:var(--bg-card,#1e293b);border:1px solid var(--border);border-radius:8px;z-index:500;padding:6px;margin-top:4px;box-shadow:0 4px 20px rgba(0,0,0,0.4)">
                        <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;border-radius:4px;color:var(--text,#f1f5f9);font-size:0.85em"><input type="checkbox" class="harmony-member-cb" value="drew" onchange="updateHarmonyMembers()" style="accent-color:var(--accent)"> Drew</label>
                        <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;border-radius:4px;color:var(--text,#f1f5f9);font-size:0.85em"><input type="checkbox" class="harmony-member-cb" value="chris" onchange="updateHarmonyMembers()" style="accent-color:var(--accent)"> Chris</label>
                        <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;border-radius:4px;color:var(--text,#f1f5f9);font-size:0.85em"><input type="checkbox" class="harmony-member-cb" value="brian" onchange="updateHarmonyMembers()" style="accent-color:var(--accent)"> Brian</label>
                        <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;border-radius:4px;color:var(--text,#f1f5f9);font-size:0.85em"><input type="checkbox" class="harmony-member-cb" value="pierce" onchange="updateHarmonyMembers()" style="accent-color:var(--accent)"> Pierce</label>
                        <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;border-radius:4px;color:var(--text,#f1f5f9);font-size:0.85em"><input type="checkbox" class="harmony-member-cb" value="jay" onchange="updateHarmonyMembers()" style="accent-color:var(--accent)"> Jay</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Song Structure form (hidden, opens as modal) -->
    <div id="songStructureSection" style="display:none">
        <div id="songStructureContainer"></div>
        <div id="songStructureFormContainer"></div>
    </div>
</div>

<!-- Step 3: North Star (Reference Version) -->
<div class="step-card hidden" id="step3ref">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
        <div class="step-number" style="flex-shrink:0">3</div>
        <h2 style="margin:0">The North Star</h2>
    </div>
    <p class="subtitle">The definitive version your band is learning â€” voted by the group</p>
    
    <div class="resource-section" id="refVersionSection">
        <div class="section-header">
            <h3>â­ Reference Version (Band Voted)</h3>
            <p style="color:var(--text-muted,#94a3b8);font-size:0.85em">
                Vote on which version to learn â€” any link works (Spotify, YouTube, Archive.org, etc.)
                <button onclick="searchRefVersion()" title="Search for this song and paste any URL here" style="background:none;border:none;color:var(--accent-light,#818cf8);text-decoration:underline;cursor:pointer;font-size:0.9em;padding:0;margin-left:12px">ğŸ” Find on Spotify / YouTube</button>
            </p>
        </div>
        <div id="spotifyVersionsContainer"></div>
        <button class="secondary-btn" id="addRefVersionBtn" style="margin-top:12px">+ Suggest Reference Version</button>
    </div>
</div>

<!-- Step 4: Stage Cheat Sheets -->
<div class="step-card hidden" id="step4ref">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
        <div class="step-number" style="flex-shrink:0">4</div>
        <h2 style="margin:0">Stage Crib Notes</h2>
    </div>
    <p class="subtitle">Each member's go-to reference â€” tabs, chord charts, or lyrics for stage/iPad
        <button onclick="searchUltimateGuitar()" style="background:none;border:none;color:var(--accent-light,#818cf8);text-decoration:underline;cursor:pointer;font-size:0.85em;padding:0;margin-left:8px">ğŸ” Ultimate Guitar</button>
    </p>
    
    <div class="resource-section" id="personalTabsSection">
        <div id="personalTabsContainer"></div>
    </div>
</div>

<!-- Step 4b: Cover Me -->
<div class="step-card hidden" id="step4cover">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
        <div class="step-number" style="flex-shrink:0;font-size:0.8em">4b</div>
        <h2 style="margin:0">Cover Me ğŸ¤</h2>
    </div>
    <p class="subtitle">Other bands' takes â€” covers, tribute versions, different arrangements worth learning from</p>
    <div class="resource-section" id="coverMeSection">
        <div id="coverMeContainer"></div>
        <button class="secondary-btn" onclick="showAddCoverMeForm()" style="margin-top:12px">+ Add Cover Version</button>
    </div>
</div>

<!-- Step 5: Practice Workshop -->
<div class="step-card hidden" id="step5ref">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
        <div class="step-number" style="flex-shrink:0">5</div>
        <h2 style="margin:0">The Woodshed</h2>
    </div>
    <p class="subtitle">Practice tools, stems, harmony parts & band notes</p>
    
    <!-- CHORD CHART (The Band's Chart) -->
    <div class="resource-section" id="chartSection">
        <div class="section-header">
            <h3>ğŸ¸ The Chart</h3>
            <p style="color:var(--text-muted,#94a3b8);font-size:0.85em">One shared chord chart â€” replaces Ultimate Guitar</p>
        </div>
        <div id="chartContainer"></div>
    </div>
    
    <!-- MOISES STEMS -->
    <div class="resource-section" id="moisesSection">
        <div class="section-header">
            <h3>ğŸšï¸ Moises Stems</h3>
            <p style="color:var(--text-muted,#94a3b8);font-size:0.85em">Isolate individual instruments for practice</p>
        </div>
        <div id="moisesStemsContainer"></div>
    </div>
    
    <!-- PRACTICE TRACKS -->
    <div class="resource-section" id="practiceTracksSection">
        <div class="section-header">
            <h3>ğŸ¸ Practice Tracks</h3>
            <p style="color:var(--text-muted,#94a3b8);font-size:0.85em">Add videos â€” auto-fetches title & thumbnail</p>
        </div>
        <div id="practiceTrackAddForm" style="background:rgba(255,255,255,0.03);padding:16px;border-radius:10px;margin-bottom:16px;border:1px solid var(--border,rgba(255,255,255,0.08))">
            <h4 style="margin:0 0 12px 0;color:var(--text,#f1f5f9);font-size:0.95em">Add Practice Track</h4>
            <div style="margin-bottom:10px">
                <label style="display:block;margin-bottom:4px;font-weight:600;color:var(--text-muted,#94a3b8);font-size:0.85em">Video URL:</label>
                <input type="text" id="practiceTrackUrlInput" placeholder="Paste YouTube, Vimeo, or any video URL" class="app-input" style="width:100%;box-sizing:border-box">
            </div>
            <div style="margin-bottom:10px">
                <label style="display:block;margin-bottom:4px;font-weight:600;color:var(--text-muted,#94a3b8);font-size:0.85em">Instrument:</label>
                <select id="practiceTrackInstrument" class="app-select" style="width:100%">
                    <option value="">-- Select Instrument --</option>
                    <option value="bass">ğŸ¸ Bass</option>
                    <option value="leadGuitar">ğŸ¸ Lead Guitar</option>
                    <option value="rhythmGuitar">ğŸ¸ Rhythm Guitar</option>
                    <option value="keys">ğŸ¹ Keys/Keyboards</option>
                    <option value="drums">ğŸ¥ Drums</option>
                    <option value="vocals">ğŸ¤ Vocals</option>
                    <option value="wholeBand">ğŸ¶ Whole Band</option>
                </select>
            </div>
            <div style="margin-bottom:12px">
                <label style="display:block;margin-bottom:4px;font-weight:600;color:var(--text-muted,#94a3b8);font-size:0.85em">Notes (optional):</label>
                <input type="text" id="practiceTrackNotes" placeholder="E.g., Great breakdown of the bass line" class="app-input" style="width:100%;box-sizing:border-box">
            </div>
            <div style="display:flex;gap:8px">
                <button id="addPracticeTrackBtn" class="btn btn-primary" onclick="addPracticeTrackSimple()" style="flex:1">âœ¨ Add Track</button>
                <button class="btn btn-ghost" onclick="ptToggleUploadForm()" style="white-space:nowrap">ğŸ“ Upload MP3</button>
            </div>
            <!-- MP3 upload form (hidden by default) -->
            <div id="ptUploadForm" style="display:none;margin-top:12px;padding-top:12px;border-top:1px solid var(--border,rgba(255,255,255,0.08))">
                <div style="margin-bottom:10px">
                    <label style="display:block;margin-bottom:4px;font-weight:600;color:var(--text-muted,#94a3b8);font-size:0.85em">Audio File:</label>
                    <input type="file" id="ptAudioFile" accept="audio/*,.mp3,.m4a,.wav,.aac"
                        style="width:100%;padding:8px;background:rgba(255,255,255,0.05);border:1px solid var(--border,rgba(255,255,255,0.12));border-radius:8px;color:var(--text,#f1f5f9);font-size:0.85em;box-sizing:border-box">
                    <div style="font-size:0.76em;color:var(--text-dim,#64748b);margin-top:3px">MP3, M4A, WAV Â· max 20MB Â· uploaded to Firebase, shared with band</div>
                </div>
                <div style="margin-bottom:10px">
                    <label style="display:block;margin-bottom:4px;font-weight:600;color:var(--text-muted,#94a3b8);font-size:0.85em">Track Title:</label>
                    <input type="text" id="ptUploadTitle" placeholder="e.g. Bass isolated, Whole band slow run-through" class="app-input" style="width:100%;box-sizing:border-box">
                </div>
                <div id="ptUploadProgress" style="display:none;margin-bottom:8px">
                    <div style="background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;height:6px">
                        <div id="ptUploadBar" style="height:100%;background:var(--accent,#6366f1);width:0%;transition:width 0.3s"></div>
                    </div>
                    <div id="ptUploadStatus" style="font-size:0.78em;color:var(--text-dim,#64748b);margin-top:3px;text-align:center">Uploadingâ€¦</div>
                </div>
                <button class="btn btn-primary" onclick="addPracticeTrackUpload()" style="width:100%">ğŸ“¤ Upload & Add Track</button>
            </div>
        </div>
        <div id="practiceTracksContainer"></div>
    </div>
    
    <!-- HARMONIES -->
    <div class="resource-section" id="harmoniesSection">
        <div class="section-header">
            <h3>ğŸ¤ Harmony Parts</h3>
            <p style="color:var(--text-muted,#94a3b8);font-size:0.85em">Who sings what, when</p>
        </div>
        <div id="harmoniesContainer"></div>
    </div>

    <!-- SONG IN PLAYLISTS -->
    <div class="resource-section" id="songPlaylistsSection" style="margin-top:8px">
        <div style="font-size:0.8em;color:var(--text-muted,#94a3b8);font-weight:600;margin-bottom:6px">ğŸ“‹ In Playlists:</div>
        <div id="songPlaylistsContainer"></div>
    </div>
    
    <!-- REHEARSAL NOTES -->
    <div class="resource-section" id="rehearsalNotesSection">
        <div class="section-header">
            <h3>ğŸ“‹ Rehearsal Notes</h3>
            <p style="color:var(--text-muted,#94a3b8);font-size:0.85em">Band feedback and tips â€” anyone can add</p>
        </div>
        <div id="rehearsalNoteFormContainer"></div>
        <div id="rehearsalNotesContainer"></div>
        <button class="secondary-btn" onclick="showRehearsalNoteForm()" style="margin-top:12px">+ Add Note</button>
    </div>
    
    <!-- GIG NOTES / PERFORMANCE TIPS -->
    <div class="resource-section" id="gigNotesSection">
        <div class="section-header">
            <h3>ğŸ¤ Performance Tips</h3>
        </div>
        <div id="gigNotesContainer"></div>
    </div>
    
    <!-- MULTI-TRACK STUDIO (Audio Snippets) -->
</div><!-- end step5ref -->
        <!-- Step 3: Version Selection (renumbered from Step 2) -->
        <div class="step-card hidden" id="step3">
            <div class="step-number">3</div>
            <h2>Top 5 Live Versions</h2>
            <p class="step-description">Based on community rankings and sound quality</p>
            <div id="versionsContainer">
                <!-- Top 5 versions populated here -->
            </div>
        </div>

        <!-- Step 4: Download (renumbered from Step 3) -->
        <div class="step-card hidden" id="step4">
            <div class="step-number">4</div>
            <h2>Download & Upload to Moises</h2>
            <div class="download-card">
                <div class="selected-info" id="selectedInfo">
                    <!-- Selected song and version info -->
                </div>
                <div class="action-buttons">
                    <button class="primary-btn smart-download-btn" id="smartDownloadBtn" style="background: #10b981;">
                        âš¡ Smart Download (Just This Song!)
                    </button>
                    <button class="primary-btn" id="downloadBtn">
                        â¬‡ï¸ Download Full Show from Archive.org
                    </button>
                    <button class="primary-btn moises-btn" id="moisesBtn">
                        ğŸ›ï¸ Open Moises.ai Studio
                    </button>
                    <button class="primary-btn" id="setlistBtn" style="background: #48bb78;">
                        ğŸ“‹ View Setlist (Song Order & Timing)
                    </button>
                    <button class="primary-btn youtube-btn" id="youtubeSearchBtn" style="background: #ef4444;">
                        ğŸ¥ Search YouTube for This Song
                    </button>
                </div>
                <div id="progressContainer" class="hidden" style="margin-top: 15px; padding: 15px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner"></div>
                        <div>
                            <strong id="progressMessage">Processing...</strong>
                            <div style="margin-top: 5px; height: 8px; background: #dbeafe; border-radius: 4px; overflow: hidden;">
                                <div id="progressBar" style="height: 100%; background: #3b82f6; width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="workflow-guide">
                    <h3>ğŸ“‹ Your Practice Workflow:</h3>
                    <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #48bb78;">
                            <strong>âœ… STEP 1: Download MP3</strong>
                            <p style="margin: 5px 0 0 0; color: #4a5568; font-size: 0.9em;">
                                Click "Download MP3" button above â†’ Find the file on Archive.org â†’ Right-click â†’ Save to Downloads
                            </p>
                        </div>
                        <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #4299e1;">
                            <strong>â¬†ï¸ STEP 2: Upload to Moises</strong>
                            <p style="margin: 5px 0 0 0; color: #4a5568; font-size: 0.9em;">
                                Click "Open Moises.ai Studio" â†’ Click Upload â†’ Select your downloaded MP3
                            </p>
                        </div>
                        <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #ed8936;">
                            <strong>âš™ï¸ STEP 3: Separate Stems</strong>
                            <p style="margin: 5px 0 0 0; color: #4a5568; font-size: 0.9em;">
                                Choose "6 Stems" separation â†’ Wait 1-2 minutes for AI processing
                            </p>
                        </div>
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #667eea;">
                            <strong>ğŸ¸ STEP 4: Solo Your Part</strong>
                            <p style="margin: 5px 0 0 0; color: #4a5568; font-size: 0.9em;">
                                Click "Solo" on your instrument â†’ Adjust tempo â†’ Loop sections â†’ Practice!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Part Selection Guide (renumbered from Step 4) -->
        <div class="step-card hidden" id="step5">
            <div class="step-number">5</div>
            <h2>Isolate Your Part in Moises</h2>
            <div class="parts-grid">
                <div class="part-card">
                    <div class="part-icon">ğŸ¤</div>
                    <h3>Vocals / Harmonies</h3>
                    <p>Solo the vocals track to learn melody and harmonies</p>
                </div>
                <div class="part-card">
                    <div class="part-icon">ğŸ¸</div>
                    <h3>Jerry Garcia (Lead)</h3>
                    <p>Isolate lead guitar to learn solos and fills</p>
                </div>
                <div class="part-card">
                    <div class="part-icon">ğŸ¸</div>
                    <h3>Bob Weir (Rhythm)</h3>
                    <p>Focus on rhythm guitar and chord progressions</p>
                </div>
                <div class="part-card">
                    <div class="part-icon">ğŸ¸</div>
                    <h3>Phil Lesh (Bass)</h3>
                    <p>Learn Phil's melodic bass lines</p>
                </div>
                <div class="part-card">
                    <div class="part-icon">ğŸ¥</div>
                    <h3>Drums</h3>
                    <p>Practice the groove and fills</p>
                </div>
                <div class="part-card">
                    <div class="part-icon">ğŸ¹</div>
                    <h3>Keyboards</h3>
                    <p>Isolate keys for atmospheric parts</p>
                </div>
            </div>
        </div>

        <!-- Reset Button -->
        <div class="reset-container hidden" id="resetContainer">
            <button class="reset-btn" onclick="resetWorkflow()">
                â†º Start Over with New Song
            </button>
        </div>
        

        

    </div>
        </div><!-- end page-songs -->

        <!-- Dynamic pages rendered by JS -->
        <div id="page-setlists" class="app-page hidden"></div>
        <div id="page-playlists" class="app-page hidden"></div>
        <div id="page-practice" class="app-page hidden"></div>
        <div id="page-calendar" class="app-page hidden"></div>
        <div id="page-gigs" class="app-page hidden"></div>
        <div id="page-venues" class="app-page hidden"></div>
        <div id="page-finances" class="app-page hidden"></div>
        <div id="page-tuner" class="app-page hidden"></div>
        <div id="page-metronome" class="app-page hidden"></div>
        <div id="page-equipment" class="app-page hidden"></div>
        <div id="page-contacts" class="app-page hidden"></div>
        <div id="page-social" class="app-page hidden"></div>
        <div id="page-admin" class="app-page hidden"></div>
        <div id="page-notifications" class="app-page hidden"></div>
        <div id="page-help" class="app-page hidden"></div>
    </div>

    <footer style="text-align:center;padding:20px;font-size:0.8em;">
        <p style="margin-bottom:4px">Deadcetera â€” Band HQ Â· Less admin. More jams. ğŸ¤˜</p>
        <p style="font-size:0.72em;color:var(--text-dim,#64748b)">Â© 2025â€“2026 Drew Merrill. All rights reserved.</p>
    </footer>

    <script src="data.js"></script>
    <script src="app.js"></script>
    <script src="rehearsal-mode.js"></script>
    <script src="help.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => {
                        console.log('[SW] Registered:', reg.scope);
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                }
                            });
                        });
                    })
                    .catch(err => console.log('[SW] Registration failed:', err));
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data?.type === 'SW_UPDATED') {
                        // showUpdateBanner is defined in app.js â€” call it if ready, else retry
                        if (typeof showUpdateBanner === 'function') {
                            showUpdateBanner();
                        } else {
                            setTimeout(() => { if (typeof showUpdateBanner === 'function') showUpdateBanner(); }, 2000);
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>
